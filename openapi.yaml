openapi: 3.0.3
info:
  title: Event Management API
  version: 1.0.0
  description: >
    Backend API for managing users, events, likes, follows, and tickets.
    Uses JWT-based authentication stored in an HTTP-only cookie.

servers:
  - url: https://eventmanager-2-upuo.onrender.com
    description: Production server
  - url: http://localhost:3000
    description: Local development server

tags:
  - name: Auth
    description: User authentication & follow / liked events
  - name: Events
    description: Event creation, listing, likes, and feed
  - name: Tickets
    description: Ticket purchase and cancellation

paths:
  /user/signup:
    post:
      tags: [Auth]
      summary: User signup
      operationId: signupUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupRequest"
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BaseResponse"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/login:
    post:
      tags: [Auth]
      summary: User login
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful; JWT set in HTTP-only cookie
          headers:
            Set-Cookie:
              description: JWT token set as HTTP-only cookie named "token"
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BaseResponse"
        "400":
          description: Invalid credentials / validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/{id}/follow:
    post:
      tags: [Auth]
      summary: Follow a user
      operationId: followUser
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: User ID to follow
      responses:
        "200":
          description: User followed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BaseResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/{id}/unfollow:
    post:
      tags: [Auth]
      summary: Unfollow a user
      operationId: unfollowUser
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: User ID to unfollow
      responses:
        "200":
          description: User unfollowed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BaseResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /user/like_events:
    get:
      tags: [Auth]
      summary: Get events liked by logged-in user
      operationId: getLikedEvents
      security:
        - cookieAuth: []
      responses:
        "200":
          description: List of liked events
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /event:
    get:
      tags: [Events]
      summary: Get list of events
      operationId: getEvents
      parameters:
        - in: query
          name: venue
          schema:
            type: string
          description: Filter by venue (partial match)
        - in: query
          name: minPrice
          schema:
            type: number
          description: Minimum ticket price
        - in: query
          name: maxPrice
          schema:
            type: number
          description: Maximum ticket price
        - in: query
          name: upcomingOnly
          schema:
            type: boolean
          description: Only upcoming events (time > now)
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [time, popularity]
          description: Sort by time or popularity
        - in: query
          name: order
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
      responses:
        "200":
          description: List of events
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags: [Events]
      summary: Create a new event
      operationId: createEvent
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateEventRequest"
      responses:
        "201":
          description: Event created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Event created successfully
                  data:
                    $ref: "#/components/schemas/Event"
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /event/most-liked:
    get:
      tags: [Events]
      summary: Get most liked events
      operationId: mostLikedEvents
      security:
        - cookieAuth: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            default: 5
          description: Max number of events to return
      responses:
        "200":
          description: Top liked events
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /event/feed:
    get:
      tags: [Events]
      summary: Get events feed from followed users
      operationId: getEventFromFollowedUsers
      security:
        - cookieAuth: []
      responses:
        "200":
          description: List of events from followed users
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Event"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /event/{id}/like:
    patch:
      tags: [Events]
      summary: Like or unlike an event (toggle)
      operationId: toggleLikeEvent
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Event ID
      responses:
        "200":
          description: Like/unlike result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Event liked successfully
                  likeCount:
                    type: integer
                    example: 5
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Event not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /event/{id}/ticket:
    post:
      tags: [Tickets]
      summary: Buy a ticket for an event
      operationId: buyTicket
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Event ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BuyTicketRequest"
      responses:
        "201":
          description: Ticket purchased successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Ticket purchased successfully
                  data:
                    $ref: "#/components/schemas/Ticket"
        "400":
          description: No tickets available / validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Event not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags: [Tickets]
      summary: Cancel ticket for logged-in user for given event
      operationId: cancelTicket
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Event ID
      responses:
        "200":
          description: Ticket cancelled successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BaseResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Ticket or event not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: token
      description: JWT auth token stored in HTTP-only cookie named "token"

  schemas:
    BaseResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation successful

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Something went wrong

    SignupRequest:
      type: object
      required: [name, username, password]
      properties:
        name:
          type: string
          example: Ishan Gupta
        username:
          type: string
          example: ishan123
        password:
          type: string
          format: password
          example: strongpassword

    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          example: ishan123
        password:
          type: string
          format: password
          example: strongpassword

    CreateEventRequest:
      type: object
      required:
        - name
        - description
        - venue
        - time
        - ticketPrice
        - ticketAvailable
      properties:
        name:
          type: string
          example: Tech Conference 2025
        description:
          type: string
          example: A full-day conference on modern web and mobile development.
        venue:
          type: string
          example: Delhi
        time:
          type: string
          format: date-time
          example: 2025-12-10T10:00:00.000Z
        ticketPrice:
          type: number
          example: 499
        ticketAvailable:
          type: integer
          example: 100

    BuyTicketRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          example: Ishan Gupta

    User:
      type: object
      properties:
        _id:
          type: string
          example: 664f1e2b8c21c93d9c123456
        name:
          type: string
        username:
          type: string

    Event:
      type: object
      properties:
        _id:
          type: string
          example: 664f1e2b8c21c93d9c123456
        name:
          type: string
        description:
          type: string
        venue:
          type: string
        time:
          type: string
          format: date-time
        ticketPrice:
          type: number
        ticketAvailable:
          type: integer
        organizer:
          oneOf:
            - type: string
            - $ref: "#/components/schemas/User"
        likeCount:
          type: integer
          example: 0

    Ticket:
      type: object
      properties:
        _id:
          type: string
        event:
          type: string
          description: Event ID
        name:
          type: string
          description: Name of ticket holder
        buyer:
          type: string
          description: User ID of buyer
    Like:
      type: object
      properties:
        _id:
      type: string
    user:
      type: string
      description: ID of liker
    event:
      type: string
      description: Event ID liked
    Follow:
  type: object
  properties:
    _id:
      type: string
    follower:
      type: string
    following:
      type: string
